<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Argos V33.1 - Ranking & Numbers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #020205; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.08); }
        .tab-active { border-bottom: 3px solid #3b82f6 !important; color: white !important; font-weight: 900; }
        input[type="number"] { background: #000; border: 1px solid #334155; color: #fbbf24; padding: 4px; border-radius: 6px; width: 75px; text-align: center; font-size: 11px; font-weight: bold; }
        .nav-link { transition: all 0.2s; border-bottom: 3px solid transparent; padding-bottom: 8px; cursor: pointer; }
        .parcela-num { position: absolute; top: 12px; left: 15px; font-size: 10px; font-weight: 900; color: rgba(255,255,255,0.2); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen">

    <div id="login-screen" class="min-h-screen flex items-center justify-center p-6 bg-black">
        <div class="glass p-10 rounded-[3rem] text-center max-w-md w-full border border-white/5 shadow-2xl">
            <i data-lucide="shield-check" class="mx-auto text-blue-500 mb-6 w-16 h-16"></i>
            <h1 class="text-4xl font-black italic mb-2 text-white uppercase italic">ARGOS <span class="text-blue-500">V33.1</span></h1>
            <p class="text-[10px] font-mono text-slate-500 mb-10 tracking-[0.4em]">ADMIN: AGUS</p>
            <input id="input-username" type="text" class="w-full bg-black border border-slate-700 p-5 rounded-2xl mb-6 text-center text-white text-xl outline-none uppercase font-bold focus:border-blue-500" placeholder="NOMBRE GOBERNADOR">
            <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-500 py-5 rounded-2xl font-black uppercase text-white shadow-xl">Entrar al Sistema</button>
        </div>
    </div>

    <div id="main-ui" class="hidden p-4 md:p-8 max-w-[1600px] mx-auto">
        
        <header class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-8">
            <div class="glass p-4 rounded-3xl border-l-4 border-yellow-500 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Tokens</p><p id="stat-tokens" class="text-xl font-black text-yellow-500 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-slate-400 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Hierro</p><p id="stat-hierro" class="text-xl font-black text-slate-200 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-orange-800 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Madera</p><p id="stat-madera" class="text-xl font-black text-orange-700 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-blue-400 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Algod√≥n</p><p id="stat-algodon" class="text-xl font-black text-blue-400 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-amber-600 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Granos</p><p id="stat-granos" class="text-xl font-black text-amber-500 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-purple-600 text-center"><p class="text-[9px] font-bold text-purple-400 uppercase">Ciclo</p><p id="stat-ciclos" class="text-xl font-black text-purple-200 font-mono">0</p></div>
        </header>

        <nav class="flex gap-6 mb-8 border-b border-white/5 pb-2 overflow-x-auto no-scrollbar">
            <button onclick="changeTab('ciudad')" id="btn-ciudad" class="nav-link text-xs font-black uppercase tab-active whitespace-nowrap">üè¢ Ciudad</button>
            <button onclick="changeTab('mercado')" id="btn-mercado" class="nav-link text-xs font-black uppercase text-slate-500 whitespace-nowrap">‚öñÔ∏è Mercado</button>
            <button onclick="changeTab('ranking')" id="btn-ranking" class="nav-link text-xs font-black uppercase text-slate-500 whitespace-nowrap">üèÜ Ranking</button>
            <button onclick="changeTab('stats')" id="btn-stats" class="nav-link text-xs font-black uppercase text-slate-500 whitespace-nowrap">üìä An√°lisis</button>
            <button id="btn-admin" onclick="changeTab('config')" class="nav-link hidden text-xs font-black uppercase text-red-500 whitespace-nowrap">‚öôÔ∏è Config</button>
            <div class="ml-auto">
                <button id="btn-sync" onclick="intentarAvanzarCiclo()" class="bg-emerald-600 hover:bg-emerald-500 px-4 py-2 rounded-xl text-[10px] font-black uppercase text-white hidden">Sync Ciclo</button>
            </div>
        </nav>

        <section id="view-ciudad" class="tab-content">
            <div class="flex justify-between items-center mb-6 bg-white/5 p-4 rounded-2xl border border-white/5">
                <h3 class="font-black uppercase text-slate-400 text-[10px] tracking-widest italic">Plan Urban√≠stico Regional</h3>
                <select id="select-obra" class="bg-black text-[10px] p-2 rounded-xl text-white border border-slate-700 font-black uppercase">
                    <option value="residencial">üèòÔ∏è Residencial</option>
                    <option value="ind_metal">‚öíÔ∏è Metalurgia</option>
                    <option value="ind_madera">ü™µ Maderera</option>
                    <option value="ind_algodon">üëï Textil</option>
                    <option value="ind_granos">üåæ Alimenticia</option>
                    <option value="salud">üè• Salud</option>
                    <option value="seguridad">üëÆ Seguridad</option>
                    <option value="educacion">üéì Educaci√≥n</option>
                    <option value="vacio">üóëÔ∏è Demoler / Vac√≠o</option>
                </select>
            </div>
            <div id="grid-mapa" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </section>

        <section id="view-config" class="tab-content hidden space-y-8 pb-20">
            <div class="flex justify-between items-center bg-red-950/20 p-6 rounded-3xl border border-red-500/20">
                <h2 class="text-xl font-black text-red-500 uppercase italic">Ajustes del Servidor (Excel Sync)</h2>
                <button onclick="aplicarConfig()" class="bg-red-600 hover:bg-red-500 px-8 py-3 rounded-xl font-black text-[10px] uppercase shadow-lg">Aplicar Cambios</button>
            </div>
            
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="glass p-6 rounded-3xl overflow-hidden">
                    <h3 class="text-[11px] font-black uppercase mb-4 text-blue-400">üí∞ Costos, Producci√≥n y Habitantes</h3>
                    <table class="w-full text-left text-[11px]">
                        <thead class="text-slate-500 uppercase border-b border-white/10">
                            <tr><th class="p-2">Edificio</th><th class="p-2">Costo TK</th><th class="p-2">Prod.</th><th class="p-2">Hab.</th></tr>
                        </thead>
                        <tbody id="config-body-1"></tbody>
                    </table>
                </div>
                <div class="glass p-6 rounded-3xl overflow-hidden">
                    <h3 class="text-[11px] font-black uppercase mb-4 text-emerald-400">üèóÔ∏è Materiales Requeridos</h3>
                    <table class="w-full text-left text-[11px]">
                        <thead class="text-slate-500 uppercase border-b border-white/10">
                            <tr><th class="p-2">Edificio</th><th class="p-2">Hierro</th><th class="p-2">Madera</th></tr>
                        </thead>
                        <tbody id="config-body-2"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="view-mercado" class="tab-content hidden">
            <div class="glass p-10 rounded-[3rem] max-w-xl mx-auto text-center border border-emerald-500/20">
                <h2 class="text-xl font-black mb-8 uppercase text-emerald-500">Aduana de Exportaci√≥n</h2>
                <div class="grid gap-3" id="mercado-list"></div>
            </div>
        </section>

        <section id="view-ranking" class="tab-content hidden">
            <h2 class="text-center font-black uppercase mb-8 text-blue-500 tracking-[0.3em]">Ranking de Gobernadores</h2>
            <div id="ranking-container" class="max-w-3xl mx-auto space-y-3"></div>
        </section>
        
        <section id="view-stats" class="tab-content hidden"><div class="glass p-8 rounded-[2rem] max-w-5xl mx-auto"><canvas id="mainChart"></canvas></div></section>

    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA4APdfVXN36nhBv-DHBvQF6NdxhR62S8M", authDomain: "todosyyo-20671.firebaseapp.com", databaseURL: "https://todosyyo-20671-default-rtdb.firebaseio.com", projectId: "todosyyo-20671" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let user = "";
        let game = { tokens: 50000, poblacion: 0, recursos: { hierro: 500, madera: 500, algodon: 500, granos: 500 }, manzanas: Array(12).fill({ tipo: 'vacio', nivel: 0 }) };
        
        let EXCEL = {
            residencial: { costo: 2500, prod: 0, pop: 100, m_h: 300, m_m: 300 },
            ind_metal: { costo: 100, prod: 20, pop: 10, m_h: 150, m_m: 0 },
            ind_madera: { costo: 100, prod: 20, pop: 10, m_h: 0, m_m: 150 },
            ind_algodon: { costo: 100, prod: 20, pop: 10, m_h: 150, m_m: 150 },
            ind_granos: { costo: 100, prod: 20, pop: 10, m_h: 150, m_m: 150 },
            salud: { costo: 4500, prod: 0, pop: 150, m_h: 150, m_m: 150 },
            seguridad: { costo: 9000, prod: 0, pop: 300, m_h: 300, m_m: 300 },
            educacion: { costo: 200000, prod: 0, pop: 200, m_h: 1000, m_m: 1000 }
        };

        const EVOLUCION = {
            residencial: { n: ["Carpa", "Casa", "Mansi√≥n", "Rascacielos"], i: ["tent", "home", "building", "castle"] },
            ind_metal: { n: ["Forja", "Taller", "Fundici√≥n", "Acer√≠a"], i: ["anvil", "hammer", "factory", "container"] },
            ind_madera: { n: ["Le√±ador", "Aserradero", "Carpinter√≠a", "Maderera"], i: ["axe", "tree-pine", "saw", "warehouse"] },
            ind_algodon: { n: ["Huerto", "Tejedur√≠a", "Textiler√≠a", "Moda"], i: ["sprout", "shirt", "layers", "gem"] },
            ind_granos: { n: ["Siembra", "Granja", "Silo", "Agroindustria"], i: ["wheat", "tractor", "database", "tractor"] },
            salud: { n: ["Posta", "Cl√≠nica", "Hospital", "Centro M√©dico"], i: ["stethoscop", "heart-pulse", "hospital", "dna"] },
            seguridad: { n: ["Garita", "Comisar√≠a", "Cuartel", "Ministerio"], i: ["shield-alert", "shield", "lock", "shield-check"] },
            educacion: { n: ["Aula", "Escuela", "Colegio", "Universidad"], i: ["book", "school", "graduation-cap", "library"] },
            vacio: { n: ["Terreno Libre"], i: ["plus"] }
        };

        function login() {
            user = document.getElementById('input-username').value.trim().toUpperCase();
            if(!user) return;
            if(user === "AGUS") { 
                document.getElementById('btn-admin').classList.remove('hidden'); 
                document.getElementById('btn-sync').classList.remove('hidden'); 
            }
            db.ref('argos_world/ciudades/' + user).on('value', snap => {
                if(snap.exists()) { game = { ...game, ...snap.val() }; }
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-ui').classList.remove('hidden');
                render(); renderRanking(); renderMercado();
            });
            db.ref('argos_world/metadata/cicloActual').on('value', s => document.getElementById('stat-ciclos').innerText = s.val() || 0);
        }

        function changeTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-link').forEach(el => { el.classList.remove('tab-active', 'text-white'); el.classList.add('text-slate-500'); });
            document.getElementById('view-' + tabId).classList.remove('hidden');
            document.getElementById('btn-' + tabId).classList.add('tab-active', 'text-white');
            if(tabId === 'config') renderConfigTables();
            if(tabId === 'ranking') renderRanking();
        }

        function renderConfigTables() {
            const b1 = document.getElementById('config-body-1');
            const b2 = document.getElementById('config-body-2');
            b1.innerHTML = ""; b2.innerHTML = "";
            Object.keys(EXCEL).forEach(key => {
                b1.innerHTML += `<tr class="border-b border-white/5"><td class="p-2 font-bold uppercase text-blue-400">${key}</td>
                    <td><input type="number" id="cfg-${key}-costo" value="${EXCEL[key].costo}"></td>
                    <td><input type="number" id="cfg-${key}-prod" value="${EXCEL[key].prod}"></td>
                    <td><input type="number" id="cfg-${key}-pop" value="${EXCEL[key].pop}"></td></tr>`;
                b2.innerHTML += `<tr class="border-b border-white/5"><td class="p-2 font-bold uppercase text-emerald-400">${key}</td>
                    <td><input type="number" id="cfg-${key}-mh" value="${EXCEL[key].m_h}"></td>
                    <td><input type="number" id="cfg-${key}-mm" value="${EXCEL[key].m_m}"></td></tr>`;
            });
        }

        function aplicarConfig() {
            Object.keys(EXCEL).forEach(key => {
                EXCEL[key].costo = parseInt(document.getElementById(`cfg-${key}-costo`).value);
                EXCEL[key].prod = parseInt(document.getElementById(`cfg-${key}-prod`).value);
                EXCEL[key].pop = parseInt(document.getElementById(`cfg-${key}-pop`).value);
                EXCEL[key].m_h = parseInt(document.getElementById(`cfg-${key}-mh`).value);
                EXCEL[key].m_m = parseInt(document.getElementById(`cfg-${key}-mm`).value);
            });
            alert("TABLAS DE EXCEL ACTUALIZADAS");
            changeTab('ciudad');
        }

        function render() {
            document.getElementById('stat-tokens').innerText = Math.floor(game.tokens).toLocaleString();
            document.getElementById('stat-hierro').innerText = game.recursos.hierro || 0;
            document.getElementById('stat-madera').innerText = game.recursos.madera || 0;
            document.getElementById('stat-algodon').innerText = game.recursos.algodon || 0;
            document.getElementById('stat-granos').innerText = game.recursos.granos || 0;
            const grid = document.getElementById('grid-mapa'); grid.innerHTML = "";
            
            game.manzanas.forEach((m, i) => {
                const evo = EVOLUCION[m.tipo] || EVOLUCION.vacio;
                const idx = Math.min(m.nivel > 0 ? m.nivel - 1 : 0, evo.n.length - 1);
                const div = document.createElement('div');
                div.className = `glass p-6 rounded-[2rem] border-2 flex flex-col items-center justify-center min-h-[180px] relative transition-all hover:border-blue-500/40 ${m.tipo === 'vacio' ? 'border-dashed border-slate-800' : 'border-blue-500/20 shadow-xl shadow-blue-500/5'}`;
                div.innerHTML = `
                    <span class="parcela-num">PARCELA #${i+1}</span>
                    ${m.tipo !== 'vacio' ? `<span class="lvl-tag">NVL ${m.nivel}</span>` : ''}
                    <i data-lucide="${evo.i[idx]}" class="mb-3 ${m.tipo === 'vacio' ? 'text-slate-800' : 'text-blue-500'} w-10 h-10"></i>
                    <p class="text-[12px] font-black uppercase text-center text-white mb-1">${evo.n[idx]}</p>
                    <p class="text-[8px] font-bold text-slate-500 uppercase mb-4 tracking-widest">${m.tipo}</p>
                    ${m.tipo === 'vacio' ? 
                        `<button onclick="construir(${i})" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-xl text-[9px] font-black uppercase shadow-lg shadow-blue-600/20">Construir</button>` : 
                        `<button onclick="upgrade(${i})" class="bg-emerald-600 hover:bg-emerald-500 px-6 py-2 rounded-xl text-[9px] font-black uppercase shadow-lg shadow-emerald-600/20">Mejorar</button>`
                    }`;
                grid.appendChild(div);
            });
            lucide.createIcons();
        }

        function construir(idx) {
            const tipo = document.getElementById('select-obra').value;
            if(tipo === 'vacio') return;
            const c = EXCEL[tipo];
            if(game.tokens < c.costo || (game.recursos.hierro || 0) < c.m_h || (game.recursos.madera || 0) < c.m_m) return alert("RECURSOS INSUFICIENTES");
            game.tokens -= c.costo; game.recursos.hierro -= c.m_h; game.recursos.madera -= c.m_m;
            game.manzanas[idx] = { tipo: tipo, nivel: 1 };
            save();
        }

        function upgrade(idx) {
            const m = game.manzanas[idx];
            const costo = m.nivel * EXCEL[m.tipo].costo;
            if(game.tokens < costo) return alert("FALTAN TOKENS");
            game.tokens -= costo; m.nivel++;
            save();
        }

        function vender(r) { if(game.recursos[r] >= 100) { game.recursos[r] -= 100; game.tokens += 1000; save(); renderMercado(); } }
        function save() { db.ref('argos_world/ciudades/' + user).update(game); }
        function renderMercado() { const list = document.getElementById('mercado-list'); list.innerHTML = ""; ['hierro', 'madera', 'algodon', 'granos'].forEach(r => { list.innerHTML += `<button onclick="vender('${r}')" class="flex justify-between p-4 bg-white/5 rounded-2xl border border-white/10 hover:border-emerald-500 transition-all font-black uppercase text-[10px]"><span>Exportar ${r} (100)</span><span class="text-emerald-400 font-mono">+1.000 TK</span></button>`; }); }
        
        function renderRanking() { 
            db.ref('argos_world/ciudades').once('value', snap => { 
                const container = document.getElementById('ranking-container'); 
                container.innerHTML = ""; 
                const data = snap.val() || {};
                Object.keys(data).sort((a,b)=>data[b].tokens - data[a].tokens).forEach((key, i) => { 
                    const city = data[key];
                    container.innerHTML += `
                        <div class="glass p-4 rounded-2xl flex justify-between items-center border-l-4 ${i===0?'border-yellow-500':'border-blue-500'}">
                            <div class="flex items-center gap-4">
                                <span class="font-black text-blue-500 text-lg">#${i+1}</span>
                                <div>
                                    <p class="font-black uppercase text-[12px] leading-tight">${key}</p>
                                    <p class="text-[9px] text-slate-500 font-bold uppercase tracking-tighter">üë• Poblaci√≥n: ${city.poblacion || 0}</p>
                                </div>
                            </div>
                            <span class="font-black text-emerald-400 font-mono text-lg">${Math.floor(city.tokens).toLocaleString()} TK</span>
                        </div>`; 
                }); 
            }); 
        }
        
        function intentarAvanzarCiclo() {
            let totalPop = 0;
            game.manzanas.forEach(m => {
                if(m.tipo === 'vacio') return;
                const conf = EXCEL[m.tipo];
                totalPop += (m.nivel * conf.pop);
                if(m.tipo.includes('ind')) {
                    const res = m.tipo.split('_')[1] === 'metal' ? 'hierro' : m.tipo.split('_')[1];
                    game.recursos[res] = (game.recursos[res] || 0) + (m.nivel * conf.prod);
                }
            });
            game.poblacion = totalPop;
            game.tokens += totalPop;
            db.ref('argos_world/metadata/cicloActual').transaction(c => (c || 0) + 1);
            save();
            alert("Ciclo Sincronizado: Poblaci√≥n total sumada como tokens.");
        }
    </script>
</body>
</html>