<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Argos V22.4 - GitHub Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background-color: #020205; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.08); }
        .tab-active { border-bottom: 3px solid #3b82f6 !important; color: white !important; font-weight: 900; }
        input[type="number"] { background: #000; border: 1px solid #334155; color: #fbbf24; padding: 4px; border-radius: 6px; width: 65px; text-align: center; font-size: 11px; }
        .nav-link { transition: all 0.2s; border-bottom: 3px solid transparent; padding-bottom: 8px; cursor: pointer; text-transform: uppercase; font-size: 11px; font-weight: 800; color: #64748b; }
        .lvl-tag { position: absolute; top: 12px; right: 12px; font-size: 10px; font-weight: 900; background: #1e3a8a; padding: 2px 8px; border-radius: 8px; color: #60a5fa; border: 1px solid #2563eb; }
        .table-admin th { padding: 10px; font-size: 10px; color: #3b82f6; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left; }
        .table-admin td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 11px; }
    </style>
</head>
<body class="min-h-screen">

    <div id="login-screen" class="min-h-screen flex items-center justify-center p-6 bg-black">
        <div class="glass p-10 rounded-[3rem] text-center max-w-md w-full border border-white/5">
            <i data-lucide="shield-check" class="mx-auto text-blue-500 mb-6 w-16 h-16"></i>
            <h1 class="text-4xl font-black italic mb-2 text-white uppercase tracking-tighter">ARGOS <span class="text-blue-500">V22.4</span></h1>
            <p class="text-[10px] font-mono text-slate-500 mb-10 tracking-[0.4em]">ADMIN: AGUS</p>
            <input id="input-username" type="text" class="w-full bg-black border border-slate-700 p-5 rounded-2xl mb-6 text-center text-white text-xl outline-none uppercase font-bold focus:border-blue-500" placeholder="NOMBRE">
            <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-500 py-5 rounded-2xl font-black uppercase text-white">Entrar</button>
        </div>
    </div>

    <div id="main-ui" class="hidden p-4 md:p-8 max-w-[1600px] mx-auto">
        
        <header class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-8">
            <div class="glass p-4 rounded-3xl border-l-4 border-yellow-500 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Tokens</p><p id="stat-tokens" class="text-xl font-black text-yellow-500 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-slate-400 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Hierro</p><p id="stat-hierro" class="text-xl font-black text-slate-200 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-orange-800 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Madera</p><p id="stat-madera" class="text-xl font-black text-orange-700 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-blue-400 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Algod√≥n</p><p id="stat-algodon" class="text-xl font-black text-blue-400 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-amber-600 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase">Granos</p><p id="stat-granos" class="text-xl font-black text-amber-500 font-mono">0</p></div>
            <div class="glass p-4 rounded-3xl border-l-4 border-purple-600 text-center"><p class="text-[9px] font-bold text-purple-400 uppercase">Ciclo</p><p id="stat-ciclos" class="text-xl font-black text-purple-200 font-mono">0</p></div>
        </header>

        <nav class="flex gap-8 mb-8 border-b border-white/5 pb-2 overflow-x-auto">
            <button onclick="changeTab('ciudad')" id="btn-ciudad" class="nav-link tab-active">üè¢ Ciudad</button>
            <button onclick="changeTab('mercado')" id="btn-mercado" class="nav-link">‚öñÔ∏è Mercado</button>
            <button onclick="changeTab('ranking')" id="btn-ranking" class="nav-link">üèÜ Ranking</button>
            <button id="btn-config" onclick="changeTab('config')" class="nav-link hidden !text-red-500">‚öôÔ∏è Config</button>
            <div class="ml-auto">
                <button id="btn-sync" onclick="intentarAvanzarCiclo()" class="bg-emerald-600 px-4 py-2 rounded-xl text-[10px] font-black uppercase text-white hidden">Sincronizar</button>
            </div>
        </nav>

        <section id="view-ciudad" class="tab-content">
            <div class="flex justify-between items-center mb-6 bg-white/5 p-4 rounded-2xl border border-white/5">
                <select id="select-obra" class="bg-black text-[10px] p-2 rounded-xl text-white border border-slate-700 font-black uppercase w-full max-w-xs"></select>
            </div>
            <div id="grid-mapa" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </section>

        <section id="view-mercado" class="tab-content hidden">
            <div class="glass p-8 rounded-[2rem] max-w-xl mx-auto border border-emerald-500/20">
                <h2 class="text-center font-black uppercase text-emerald-500 mb-6">Puerto de Exportaci√≥n</h2>
                <div id="mercado-list" class="space-y-3"></div>
            </div>
        </section>

        <section id="view-ranking" class="tab-content hidden">
            <div id="ranking-container" class="max-w-xl mx-auto space-y-3"></div>
        </section>

        <section id="view-config" class="tab-content hidden space-y-6">
            <div class="flex justify-between items-center bg-red-950/20 p-6 rounded-3xl border border-red-500/20">
                <h2 class="text-xl font-black text-red-500 uppercase">Tablas Maestras (Excel Sync)</h2>
                <button onclick="aplicarConfig()" class="bg-red-600 px-6 py-3 rounded-xl font-black text-[10px] uppercase">Guardar Cambios</button>
            </div>
            <div class="glass p-4 rounded-[2rem] overflow-x-auto">
                <table class="w-full table-admin">
                    <thead>
                        <tr><th>Rubro</th><th>Edificio</th><th>Hab</th><th>Imp</th><th>Costo TK</th><th>Granos</th><th>Algod√≥n</th><th>Madera</th><th>Metales</th></tr>
                    </thead>
                    <tbody id="config-body-full"></tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA4APdfVXN36nhBv-DHBvQF6NdxhR62S8M", authDomain: "todosyyo-20671.firebaseapp.com", databaseURL: "https://todosyyo-20671-default-rtdb.firebaseio.com", projectId: "todosyyo-20671" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let user = "";
        let game = { tokens: 50000, recursos: { hierro: 500, madera: 500, algodon: 500, granos: 500 }, manzanas: Array(12).fill({ tipo: 'vacio', nivel: 0 }) };
        
        // VALORES PRECARGADOS DEL EXCEL
        let EXCEL = {
            "Despacho comunal": { rubro: "Gobierno", hab: 150, imp: 0, costo: 4500, r_g: 0, r_a: 0, r_m: 150, r_met: 150, icon: "landmark" },
            "Alcaldia": { rubro: "Gobierno", hab: 300, imp: 0, costo: 9000, r_g: 0, r_a: 0, r_m: 300, r_met: 300, icon: "building" },
            "Casa": { rubro: "Residencial", hab: 100, imp: 2, costo: 20000, r_g: 300, r_a: 300, r_m: 300, r_met: 300, icon: "home" },
            "Edificio": { rubro: "Residencial", hab: 200, imp: 5, costo: 200000, r_g: 1000, r_a: 1000, r_m: 1000, r_met: 1000, icon: "building-2" },
            "Mina de hierro": { rubro: "Metalurgia", hab: 10, imp: 1, costo: 100, r_g: 0, r_a: 150, r_m: 0, r_met: 150, icon: "pickaxe" },
            "Aserradero": { rubro: "Madera", hab: 10, imp: 1, costo: 100, r_g: 0, r_a: 150, r_m: 150, r_met: 0, icon: "tree-pine" },
            "Campo Algodon": { rubro: "Textil", hab: 10, imp: 1, costo: 100, r_g: 0, r_a: 0, r_m: 150, r_met: 150, icon: "shirt" },
            "Campo Granos": { rubro: "Alimenticia", hab: 10, imp: 1, costo: 100, r_g: 0, r_a: 150, r_m: 150, r_met: 0, icon: "wheat" }
        };

        function login() {
            user = document.getElementById('input-username').value.trim().toUpperCase();
            if(!user) return;
            if(user === "AGUS") { 
                document.getElementById('btn-config').classList.remove('hidden'); 
                document.getElementById('btn-sync').classList.remove('hidden'); 
            }
            db.ref('argos_world/ciudades/' + user).on('value', snap => {
                if(snap.exists()) { game = { ...game, ...snap.val() }; }
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-ui').classList.remove('hidden');
                initSelect(); render(); renderRanking(); renderMercado();
            });
            db.ref('argos_world/metadata/cicloActual').on('value', s => document.getElementById('stat-ciclos').innerText = s.val() || 0);
        }

        function initSelect() {
            const sel = document.getElementById('select-obra');
            sel.innerHTML = `<option value="vacio">DEMOLER / VAC√çO</option>`;
            Object.keys(EXCEL).forEach(id => { sel.innerHTML += `<option value="${id}">${id.toUpperCase()}</option>`; });
        }

        function changeTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('tab-active', 'text-white'));
            document.getElementById('view-' + tabId).classList.remove('hidden');
            document.getElementById('btn-' + tabId).classList.add('tab-active', 'text-white');
            if(tabId === 'config') renderAdminTables();
        }

        function renderAdminTables() {
            const body = document.getElementById('config-body-full');
            body.innerHTML = "";
            Object.keys(EXCEL).forEach(id => {
                const d = EXCEL[id];
                body.innerHTML += `<tr>
                    <td class="text-slate-500 font-bold">${d.rubro}</td>
                    <td class="text-white font-black">${id}</td>
                    <td><input type="number" id="hab-${id}" value="${d.hab}"></td>
                    <td><input type="number" id="imp-${id}" value="${d.imp}"></td>
                    <td><input type="number" id="costo-${id}" value="${d.costo}"></td>
                    <td><input type="number" id="rg-${id}" value="${d.r_g}"></td>
                    <td><input type="number" id="ra-${id}" value="${d.r_a}"></td>
                    <td><input type="number" id="rm-${id}" value="${d.r_m}"></td>
                    <td><input type="number" id="rmet-${id}" value="${d.r_met}"></td>
                </tr>`;
            });
        }

        function aplicarConfig() {
            Object.keys(EXCEL).forEach(id => {
                EXCEL[id].hab = parseInt(document.getElementById(`hab-${id}`).value);
                EXCEL[id].imp = parseInt(document.getElementById(`imp-${id}`).value);
                EXCEL[id].costo = parseInt(document.getElementById(`costo-${id}`).value);
                EXCEL[id].r_g = parseInt(document.getElementById(`rg-${id}`).value);
                EXCEL[id].r_a = parseInt(document.getElementById(`ra-${id}`).value);
                EXCEL[id].r_m = parseInt(document.getElementById(`rm-${id}`).value);
                EXCEL[id].r_met = parseInt(document.getElementById(`rmet-${id}`).value);
            });
            alert("CONFIGURACI√ìN ACTUALIZADA");
        }

        function render() {
            document.getElementById('stat-tokens').innerText = Math.floor(game.tokens).toLocaleString();
            document.getElementById('stat-hierro').innerText = game.recursos.hierro;
            document.getElementById('stat-madera').innerText = game.recursos.madera;
            document.getElementById('stat-algodon').innerText = game.recursos.algodon;
            document.getElementById('stat-granos').innerText = game.recursos.granos;
            const grid = document.getElementById('grid-mapa'); grid.innerHTML = "";
            game.manzanas.forEach((m, i) => {
                const isV = m.tipo === 'vacio';
                const d = EXCEL[m.tipo] || { icon: 'plus', rubro: 'Libre' };
                const div = document.createElement('div');
                div.className = `glass p-6 rounded-[2rem] border-2 flex flex-col items-center justify-center min-h-[180px] relative ${isV ? 'border-dashed border-slate-800' : 'border-blue-500/20 shadow-lg'}`;
                div.innerHTML = `${!isV ? `<span class="lvl-tag">${d.rubro}</span>` : ''}<i data-lucide="${d.icon}" class="mb-3 ${isV ? 'text-slate-700' : 'text-blue-500'} w-10 h-10"></i><p class="text-xs font-black uppercase text-white">${isV ? 'Vacio' : m.tipo}</p><button onclick="construir(${i})" class="mt-4 bg-blue-600 px-4 py-2 rounded-xl text-[9px] font-black uppercase">${isV ? 'Construir' : 'Cambiar'}</button>`;
                grid.appendChild(div);
            });
            lucide.createIcons();
        }

        function construir(idx) {
            const tipo = document.getElementById('select-obra').value;
            if(tipo === 'vacio') { game.manzanas[idx] = { tipo: 'vacio', nivel: 0 }; } 
            else {
                const c = EXCEL[tipo];
                if(game.tokens < c.costo || game.recursos.hierro < c.r_met || game.recursos.madera < c.r_m) return alert("FALTAN RECURSOS");
                game.tokens -= c.costo; game.recursos.hierro -= c.r_met; game.recursos.madera -= c.r_m;
                game.manzanas[idx] = { tipo: tipo, nivel: 1 };
            }
            save();
        }

        function renderMercado() {
            const m = document.getElementById('mercado-list'); m.innerHTML = "";
            ['hierro', 'madera', 'algodon', 'granos'].forEach(r => {
                m.innerHTML += `<button onclick="vender('${r}')" class="w-full flex justify-between p-4 bg-white/5 rounded-2xl border border-white/10 hover:border-emerald-500 transition-all font-black uppercase text-[10px]"><span>Exportar ${r} (100)</span><span class="text-emerald-400">+1.000 TK</span></button>`;
            });
        }

        function vender(r) { if(game.recursos[r] >= 100) { game.recursos[r] -= 100; game.tokens += 1000; save(); renderMercado(); } }
        
        function renderRanking() {
            db.ref('argos_world/ciudades').once('value', snap => {
                const c = document.getElementById('ranking-container'); c.innerHTML = "";
                const data = Object.entries(snap.val() || {}).sort((a,b) => b[1].tokens - a[1].tokens);
                data.forEach(([name, d], i) => {
                    c.innerHTML += `<div class="glass p-4 rounded-2xl flex justify-between items-center"><span class="font-black text-blue-500">#${i+1}</span><p class="font-black uppercase text-[10px]">${name}</p><span class="font-bold text-emerald-400 font-mono">${Math.floor(d.tokens).toLocaleString()} TK</span></div>`;
                });
            });
        }

        function intentarAvanzarCiclo() {
            let ingresos = 0;
            game.manzanas.forEach(m => { if(m.tipo !== 'vacio' && EXCEL[m.tipo]) { ingresos += (EXCEL[m.tipo].hab * EXCEL[m.tipo].imp); } });
            game.tokens += ingresos;
            db.ref('argos_world/metadata/cicloActual').transaction(c => (c || 0) + 1);
            save();
            alert("CICLO SINCRONIZADO. INGRESOS: " + ingresos);
        }

        function save() { db.ref('argos_world/ciudades/' + user).update(game); render(); }
    </script>
</body>
</html>